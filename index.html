<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Titration de la PEEP</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }
        h2, h3 {
            text-align: center;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        table, th, td {
            border: 1px solid #888;
        }
        th, td {
            padding: 8px;
            text-align: center;
        }
        input {
            width: 70px;
        }
        button {
            margin-top: 15px;
            padding: 10px;
            width: 100%;
            background-color: #007BFF;
            color: white;
            font-size: 16px;
            border: none;
            border-radius: 5px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .input-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            gap: 5px;
            flex-wrap: wrap;
        }
        .input-row label {
            flex: 1 1 48%;
        }
    </style>
</head>
<body>

<h2>Épreuve de titration de la PEEP</h2>

<div id="form">
    <p>Entrer jusqu'à 4 mesures :</p>
    <div id="entries"></div>
    <button onclick="ajouterLigne()">Ajouter une mesure</button>
    <button onclick="calculer()">Calculer</button>
</div>

<h3>Résultats</h3>
<table id="resultTable" style="display:none;">
    <thead>
        <tr>
            <th>#</th>
            <th>PEEP (cmH₂O)</th>
            <th>PEEP Totale</th>
            <th>VT (mL)</th>
            <th>Pplat (cmH₂O)</th>
            <th>Compliance</th>
            <th>Pression motrice</th>
            <th>Élastance</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>

<script>
    let mesureIndex = 0;

    function ajouterLigne() {
        if (mesureIndex >= 4) return;

        const container = document.getElementById("entries");
        const div = document.createElement("div");
        div.className = "input-row";
        div.innerHTML = `
            <label>PEEP <input type="number" id="peep${mesureIndex}" step="0.1"></label>
            <label>PEEP Totale <input type="number" id="peeptot${mesureIndex}" step="0.1"></label>
            <label>VT <input type="number" id="vt${mesureIndex}" step="0.1"></label>
            <label>Pplat <input type="number" id="pplat${mesureIndex}" step="0.1"></label>
        `;
        container.appendChild(div);
        mesureIndex++;
    }

    function calculer() {
        const tbody = document.querySelector("#resultTable tbody");
        tbody.innerHTML = "";
        for (let i = 0; i < mesureIndex; i++) {
            const peep = parseFloat(document.getElementById(`peep${i}`).value);
            const peeptot = parseFloat(document.getElementById(`peeptot${i}`).value);
            const vt = parseFloat(document.getElementById(`vt${i}`).value);
            const pplat = parseFloat(document.getElementById(`pplat${i}`).value);

            if (isNaN(peeptot) || isNaN(vt) || isNaN(pplat)) continue;

            const deltaP = pplat - peeptot;
            const compliance = deltaP !== 0 ? vt / deltaP : 0;
            const elastance = compliance !== 0 ? 1 / compliance : 0;

            const row = document.createElement("tr");
            row.innerHTML = `
                <td>${i + 1}</td>
                <td>${isNaN(peep) ? "-" : peep}</td>
                <td>${peeptot}</td>
                <td>${vt}</td>
                <td>${pplat}</td>
                <td>${compliance.toFixed(2)}</td>
                <td>${deltaP.toFixed(2)}</td>
                <td>${elastance.toFixed(2)}</td>
            `;
            tbody.appendChild(row);
        }

        document.getElementById("resultTable").style.display = "table";
    }

    ajouterLigne();
</script>

</body>
</html>
